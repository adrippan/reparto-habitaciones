<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reparto Habitaciones</title>
  <link rel="manifest" href="manifest.json"/>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.min.js"></script>

  <!-- Estilos básicos -->
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
      background: #f5f5f5;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #0a5e2b;
    }
    textarea {
      width: 100%;
      font-family: monospace;
      font-size: 0.9rem;
      padding: 0.5rem;
      box-sizing: border-box;
    }
    label {
      display: block;
      margin-bottom: 1rem;
    }
    button {
      background: #0a5e2b;
      color: #fff;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }
    button:hover {
      background: #0e7c3a;
    }
    pre {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      white-space: pre-wrap;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #eaeaea;
    }
  </style>
</head>
<body onload="brython()">

  <h1>Reparto de Habitaciones</h1>

  <label>
    Habitaciones h (JSON):
    <textarea id="h" rows="2">[20,6,8,10,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1]</textarea>
  </label>

  <label>
    Grupos g (JSON):
    <textarea id="g" rows="2">[20,3,4,5,6]</textarea>
  </label>

  <label>
    Mapping (JSON):
    <textarea id="mapping" rows="2">{"0":"C","1":"A","2":"B","3":"R","4":"I","5":"L","6":"LL","7":"A2","8":"S","9":"M1","10":"M2","11":"M3","12":"M4","13":"M5","14":"M6","15":"M7","16":"M8","17":"M9","18":"M10"}</textarea>
  </label>

  <button id="btn" type="button">Asignar</button>

  <pre id="error" style="color: #c00;"></pre>
  <div id="result"></div>

  <script type="text/python">
import heapq, json
from browser import document

def repartoHabitaciones(h, g):
    def cota_optimista(estado):
        asig, habs = estado
        return len(habs) - len(set(asig))

    def branch(estado):
        asig, habs = estado
        idx = len(asig)
        hijos = []
        for hab, cap in enumerate(habs):
            if g[idx] <= cap:
                es_chico = (idx % 2 == 0)
                habs_chicos = [h for pos,h in enumerate(asig) if pos%2==0]
                habs_chicas = [h for pos,h in enumerate(asig) if pos%2!=0]
                if (es_chico and hab not in habs_chicas) or (not es_chico and hab not in habs_chicos):
                    new_h = habs.copy()
                    new_h[hab] -= g[idx]
                    opt = cota_optimista((asig+[hab], new_h))
                    hijos.append((opt, (asig+[hab], new_h)))
        return hijos

    def is_complete(estado):
        return len(estado[0]) == len(g)

    A = []
    fx = 0
    ini = ([], h.copy())
    heapq.heappush(A, (-cota_optimista(ini), ini))

    while A and -A[0][0] > fx:
        _, estado = heapq.heappop(A)
        for sc, child in branch(estado):
            if is_complete(child):
                if sc > fx:
                    fx, sol = sc, child
            else:
                if sc > fx:
                    heapq.heappush(A, (-sc, child))
    return sol, fx

def run(ev=None):
    document["error"].text = ""
    document["result"].html = ""
    try:
        h = json.loads(document["h"].value)
        g = json.loads(document["g"].value)
        mapping = json.loads(document["mapping"].value)
    except Exception as e:
        document["error"].text = "Error de JSON: " + str(e)
        return

    try:
        (asig, rem), vacias = repartoHabitaciones(h, g)
    except Exception as e:
        document["error"].text = "Error de algoritmo: " + str(e)
        return

    # Construye tabla de asignación
    rows = []
    rows.append("<table><tr><th>Grupo</th><th>Sexo</th><th>Habitación</th></tr>")
    for i, hab in enumerate(asig):
        grp = i//2 + 1
        sexo = "CHICOS" if i%2==0 else "CHICAS"
        rows.append(f"<tr><td>G{grp}</td><td>{sexo}</td><td>{mapping.get(str(hab), hab)}</td></tr>")
    rows.append("</table>")

    # Tabla de capacidades restantes
    rows.append("<table><tr><th>Habitación</th><th>Capacidad restante</th></tr>")
    for idx, cap in enumerate(rem):
        name = mapping.get(str(idx), idx)
        rows.append(f"<tr><td>{name}</td><td>{cap}</td></tr>")
    rows.append("</table>")

    # Número de habitaciones vacías
    rows.append(f"<p><strong>Habitaciones vacías:</strong> {vacias}</p>")

    document["result"].html = "".join(rows)

document["btn"].bind("click", run)
  </script>

</body>
</html>
