<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reparto Habitaciones</title>
  <link rel="manifest" href="manifest.json"/>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.min.js"></script>
</head>
<body onload="brython()">

  <h1>Reparto de Habitaciones</h1>

  <div>
    <label>Habitaciones h (JSON):<br>
      <textarea id="h" rows="2">[20,6,8,10,20,1,1,1,1,1,1,1,1,1,1,1,1,1,1]</textarea>
    </label>
  </div>

  <div>
    <label>Grupos g (JSON):<br>
      <textarea id="g" rows="2">[20,3,4,5,6]</textarea>
    </label>
  </div>

  <div>
    <label>Mapping (JSON):<br>
      <textarea id="mapping" rows="2">{"0":"C","1":"A","2":"B","3":"R","4":"I","5":"L","6":"LL","7":"A2","8":"S","9":"M1","10":"M2","11":"M3","12":"M4","13":"M5","14":"M6","15":"M7","16":"M8","17":"M9","18":"M10"}</textarea>
    </label>
  </div>

  <div style="margin:1em 0;">
    <button id="btn" type="button">Asignar</button>
  </div>

  <pre id="output" style="white-space: pre-wrap; border:1px solid #ccc; padding:8px;"></pre>

  <!-- Toda la lógica en un solo bloque -->
  <script type="text/python">
import heapq, json
from browser import document

def repartoHabitaciones(h, g):
    def cota_optimista(estado):
        asig, habs = estado
        return len(habs) - len(set(asig))

    def branch(estado):
        asig, habs = estado
        idx = len(asig)
        hijos = []
        for hab, capacidad in enumerate(habs):
            if g[idx] <= capacidad:
                es_chico = (idx % 2 == 0)
                habs_chicos = [h for pos,h in enumerate(asig) if pos%2==0]
                habs_chicas = [h for pos,h in enumerate(asig) if pos%2!=0]
                # chicos no en habitaciones de chicas, y viceversa
                if (es_chico and hab not in habs_chicas) or (not es_chico and hab not in habs_chicos):
                    new_habs = habs.copy()
                    new_habs[hab] -= g[idx]
                    opt = cota_optimista((asig+[hab], new_habs))
                    hijos.append((opt, (asig+[hab], new_habs)))
        return hijos

    def is_complete(estado):
        return len(estado[0]) == len(g)

    A = []
    fx = 0
    ini = ([], h.copy())
    heapq.heappush(A, (-cota_optimista(ini), ini))

    while A and -A[0][0] > fx:
        _, estado = heapq.heappop(A)
        for sc, child in branch(estado):
            if is_complete(child):
                if sc > fx:
                    fx, sol = sc, child
            else:
                if sc > fx:
                    heapq.heappush(A, (-sc, child))
    return sol, fx

def run(ev=None):
    out = document["output"]
    try:
        h = json.loads(document["h"].value)
        g = json.loads(document["g"].value)
        mapping = json.loads(document["mapping"].value)
    except Exception as e:
        out.text = "Error al parsear JSON:\n" + str(e)
        return

    try:
        (asig, rem), vacias = repartoHabitaciones(h, g)
    except Exception as e:
        out.text = "Error en repartoHabitaciones:\n" + str(e)
        return

    lines = []
    for idx, hab in enumerate(asig):
        grupo = idx//2 + 1
        sexo = "CHICOS" if idx%2==0 else "CHICAS"
        lines.append(f"G{grupo}: {sexo} → hab {mapping.get(str(hab), hab)}")
    lines.append(f"\nHabitaciones vacías: {vacias}")
    out.text = "\n".join(lines)

document["btn"].bind("click", run)
  </script>

</body>
</html>
